{% extends 'base.html' %}

{% block content %}
<h2>Assign Tests to Analysts</h2>

<form method="get" action="">
    <label for="client_id">Enter Client ID:</label>
    <input type="text" id="client_id" name="client_id" value="{{ client_id|default:'' }}">
    <button type="submit">Load Samples</button>
</form>

{% if client_id %}
    <h3>Samples for Client ID: {{ client_id }}</h3>
    {% if samples %}
        <ul>
        {% for sample in samples %}
            <li>{{ sample.sample_id }}</li>
        {% endfor %}
        </ul>

        <h3>Assign Test</h3>
        <form method="post" action="?client_id={{ client_id }}">
            {% csrf_token %}
            {{ form.non_field_errors }}

            <div>
                {{ form.sample.label_tag }}<br>
                {{ form.sample }}
                {{ form.sample.errors }}
            </div>

            <div>
                {{ form.test_parameter.label_tag }}<br>
                {{ form.test_parameter }}
                {{ form.test_parameter.errors }}
            </div>

            <div id="sub_param_div">
                {{ form.sub_parameter.label_tag }}<br>
                {{ form.sub_parameter }}
                {{ form.sub_parameter.errors }}
            </div>

            <div>
                {{ form.analyst.label_tag }}<br>
                {{ form.analyst }}
                {{ form.analyst.errors }}
            </div>

            <div>
                {{ form.deadline.label_tag }}<br>
                {{ form.deadline }}
                {{ form.deadline.errors }}
            </div>

            <button type="submit">Assign Test</button>
        </form>

    {% else %}
        <p>No samples found for this client ID.</p>
    {% endif %}
{% endif %}

<script>
    const testParamSelect = document.getElementById("id_test_parameter");
    const subParamDiv = document.getElementById("sub_param_div");

    function toggleSubParam() {
        if (testParamSelect.value === "proximate") {
            subParamDiv.style.display = "block";
        } else {
            subParamDiv.style.display = "none";
            document.getElementById("id_sub_parameter").value = "";
        }
    }

    testParamSelect.addEventListener("change", toggleSubParam);
    // Initial call to set visibility on page load
    toggleSubParam();
</script>

{% endblock %}
