<div class="card shadow-lg border-0">
    <div class="card-header bg-primary text-white py-3">
        <div class="d-flex justify-content-between align-items-center">
            <h3 class="mb-0">
                <i class="fas fa-clipboard-check me-2"></i>Review Test Result
                <span class="badge bg-white text-primary ms-2">{{ assignment.sample.sample_id }}</span>
            </h3>
            <div>
                <span class="badge bg-{% if assignment.status == 'submitted' %}info{% else %}secondary{% endif %}">
                    {{ assignment.get_status_display }}
                </span>
            </div>
        </div>
    </div>
    
    <div class="card-body">
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="info-card mb-3">
                    <h5 class="info-card-header bg-light-primary">
                        <i class="fas fa-vial me-2"></i>Test Information
                    </h5>
                    <div class="info-card-body">
                        <div class="row">
                            <div class="col-6">
                                <p class="mb-1"><strong>Test Type:</strong></p>
                                <p>{{ assignment.get_test_type_display }}</p>
                            </div>
                            <div class="col-6">
                                <p class="mb-1"><strong>Analyst:</strong></p>
                                <p>{{ assignment.analyst.get_full_name|default:assignment.analyst.username }}</p>
                            </div>
                            <div class="col-6">
                                <p class="mb-1"><strong>Assigned On:</strong></p>
                                <p>{{ assignment.assigned_at|date:"M d, Y H:i" }}</p>
                            </div>
                            <div class="col-6">
                                <p class="mb-1"><strong>Submitted On:</strong></p>
                                <p>{{ assignment.completed_at|date:"M d, Y H:i" }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="info-card mb-3">
                    <h5 class="info-card-header bg-light-primary">
                        <i class="fas fa-flask me-2"></i>Sample Information
                    </h5>
                    <div class="info-card-body">
                        <div class="row">
                            <div class="col-6">
                                <p class="mb-1"><strong>Sample Name:</strong></p>
                                <p>{{ assignment.sample.name }}</p>
                            </div>
                            <div class="col-6">
                                <p class="mb-1"><strong>Client:</strong></p>
                                <p>{{ assignment.sample.client.get_full_name|default:assignment.sample.client.username }}</p>
                            </div>
                            <div class="col-6">
                                <p class="mb-1"><strong>Received On:</strong></p>
                                <p>{{ assignment.sample.date_received|date:"M d, Y" }}</p>
                            </div>
                            <div class="col-6">
                                <p class="mb-1"><strong>Urgent:</strong></p>
                                <p>{% if assignment.sample.is_urgent %}<span class="badge bg-danger">Yes</span>{% else %}No{% endif %}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="result-section mb-4">
            <h5 class="section-title mb-3">
                <i class="fas fa-file-alt me-2"></i>Test Results
            </h5>
            
            <div class="card result-card">
                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                    <span>Result Data</span>
                    {% if assignment.result_file %}
                    <a href="{{ assignment.result_file.url }}" class="btn btn-sm btn-outline-primary" download>
                        <i class="fas fa-download me-1"></i> Download Full Report
                    </a>
                    {% endif %}
                </div>
                <div class="card-body p-0">
                    <pre class="result-pre p-3 mb-0">{{ assignment.result_data }}</pre>
                </div>
            </div>
        </div>

        <form method="post" class="review-form">
            {% csrf_token %}
            <h5 class="section-title mb-3">
                <i class="fas fa-comment me-2"></i>Reviewer Comments
            </h5>
            
            <div class="mb-4">
                <textarea name="comments" class="form-control" rows="4" 
                    placeholder="Enter your review comments here...{% if assignment.review_comments %}{{ assignment.review_comments }}{% endif %}"></textarea>
                <small class="text-muted">Required for rejected results, optional for approved results</small>
            </div>
            
            <div class="d-flex justify-content-between align-items-center border-top pt-3">
                <div>
                    <a href="{% url 'review_submissions' %}" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-1"></i> Back to List
                    </a>
                </div>
                <div class="btn-group">
                    <button type="submit" name="action" value="reject" class="btn btn-danger px-4">
                        <i class="fas fa-times-circle me-1"></i> Reject
                    </button>
                    <button type="submit" name="action" value="approve" class="btn btn-success px-4">
                        <i class="fas fa-check-circle me-1"></i> Approve
                    </button>
                </div>
            </div>
        </form>
    </div>
    
    <div class="card-footer bg-light">
        <small class="text-muted">Reviewing as: {{ request.user.get_full_name|default:request.user.username }}</small>
    </div>
</div>

<style>
    .info-card {
        border: 1px solid #dee2e6;
        border-radius: 0.5rem;
        overflow: hidden;
    }
    .info-card-header {
        padding: 0.75rem 1rem;
        font-size: 1rem;
        margin: 0;
    }
    .info-card-body {
        padding: 1rem;
    }
    .result-card {
        border: 1px solid #dee2e6;
    }
    .result-pre {
        background-color: #f8f9fa;
        border-radius: 0;
        white-space: pre-wrap;
        font-family: 'Courier New', monospace;
        font-size: 0.9rem;
    }
    .section-title {
        color: #495057;
        font-weight: 600;
        border-bottom: 2px solid #dee2e6;
        padding-bottom: 0.5rem;
    }
    .bg-light-primary {
        background-color: #e7f1ff;
    }
</style>